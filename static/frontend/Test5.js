import{_ as S,a as _,r as d,c as i,o as l,b as h,d as t,t as m,e as g,g as c,F as p,f as T,n as k,w as y,u as b}from"./index.js";const C={components:{Navbar:_},setup(){return{authStore:b()}},data(){return{gameStarted:!1,gameEnded:!1,score:0,time:0,activeSquare:null,reactionTimes:[],startTime:null,gameInterval:null}},computed:{formattedTime(){return`${Math.floor(this.time/60).toString().padStart(2,"0")}:${(this.time%60).toString().padStart(2,"0")}`},accuracy(){return this.reactionTimes.length>0?(this.score/this.reactionTimes.length*100).toFixed(2):0}},methods:{startGame(){this.gameStarted=!0,this.gameEnded=!1,this.score=0,this.reactionTimes=[],this.startTime=performance.now(),this.generateRandomSquare(),this.gameInterval=setInterval(()=>{this.time++,this.time>=30&&this.endGame()},1e3)},generateRandomSquare(){this.activeSquare=Math.floor(Math.random()*30)+1},handleClick(s){if(s===this.activeSquare){const e=(performance.now()-this.startTime)/1e3;this.reactionTimes.push(e),this.score++,this.generateRandomSquare()}},endGame(){clearInterval(this.gameInterval),this.gameStarted=!1,this.gameEnded=!0,this.time=this.reactionTimes.length>0?this.reactionTimes.reduce((s,e)=>s+e,0)/this.reactionTimes.length:0,this.saveResults()},restartGame(){this.startGame()},async saveResults(){if(!this.authStore.user){alert("Пользователь не авторизован. Пожалуйста, войдите в систему.");return}const s=5,e=this.accuracy;try{const o=await fetch("http://127.0.0.1:8000/api/result/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({test:s,user:this.authStore.user.id,score_percentage:parseFloat(e)})});if(o.ok)alert("Результаты успешно сохранены!");else{const u=await o.json();alert(u.error||"Ошибка при сохранении результатов")}}catch(o){console.error("Ошибка при отправке результатов:",o)}}}},x={class:"container mt-5 text-center"},G={id:"app"},q={key:0},I={key:1},N={class:"game-area d-flex flex-wrap justify-content-center"},w=["onClick"],E={key:2,class:"end-message"};function F(s,e,o,u,r,a){const f=d("Navbar"),v=d("router-link");return l(),i(p,null,[h(f),t("div",x,[t("h2",null,m(s.$route.params.name),1),t("div",G,[!r.gameStarted&&!r.gameEnded?(l(),i("div",q,[e[2]||(e[2]=t("h1",null,"Тест реакции",-1)),e[3]||(e[3]=t("p",null,[t("strong",null,'"Тест реакции"'),c(" — это игра для развития скорости реакции и внимания. ")],-1)),e[4]||(e[4]=t("p",null,[t("strong",null,"Цель игры:"),c(" Кликать по подсвеченным элементам как можно быстрее. ")],-1)),t("button",{class:"start-button btn btn-primary",onClick:e[0]||(e[0]=(...n)=>a.startGame&&a.startGame(...n))},"Начать игру")])):r.gameStarted?(l(),i("div",I,[t("p",null,"Время: "+m(a.formattedTime),1),t("p",null,"Очки: "+m(r.score),1),t("div",N,[(l(),i(p,null,T(30,n=>t("div",{key:n,class:k(["square",{active:n===r.activeSquare}]),onClick:R=>a.handleClick(n)},null,10,w)),64))])])):g("",!0),r.gameEnded?(l(),i("div",E,[e[5]||(e[5]=t("h3",null,"Игра завершена!",-1)),t("p",null,"Среднее время реакции: "+m(r.time.toFixed(2))+" сек",1),t("p",null,"Точность: "+m(a.accuracy)+"%",1),t("button",{class:"btn btn-success",onClick:e[1]||(e[1]=(...n)=>a.restartGame&&a.restartGame(...n))},"Пройти снова")])):g("",!0),h(v,{to:"/tests",class:"btn btn-secondary mt-3"},{default:y(()=>e[6]||(e[6]=[c("Назад к тестам")])),_:1})])])],64)}const V=S(C,[["render",F],["__scopeId","data-v-355d1c14"]]);export{V as default};
