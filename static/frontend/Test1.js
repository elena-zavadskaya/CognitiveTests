import{_ as p,a as C,r as d,c as l,o as u,b as k,d as s,t as o,e as N,F as c,f as b,w as g,g as _,u as v}from"./index.js";const x={components:{Navbar:C},setup(){return{authStore:v()}},data(){return{currentView:"start",round:1,timer:null,remainingTime:60,maxNumber:12,numbers:[],shuffledNumbers:[],clickedNumbers:[],results:[],missClicks:0,totalMissClicks:0,gridDimensions:{rows:4,cols:3}}},computed:{accuracy(){const e=this.round*this.maxNumber;return e>0?((e-this.totalMissClicks)/e*100).toFixed(2):0}},methods:{startTest(){this.resetRound(),this.currentView="test",this.startTimer()},startTimer(){this.stopTimer(),this.timer=setInterval(()=>{this.remainingTime--,this.remainingTime<=0&&this.handleTimeout()},1e3)},stopTimer(){this.timer&&(clearInterval(this.timer),this.timer=null)},shuffle(e){return e.sort(()=>Math.random()-.5)},checkNumber(e){e===this.clickedNumbers.length+1?(this.clickedNumbers.push(e),this.clickedNumbers.length===this.maxNumber&&this.finishRound()):(this.missClicks+=1,this.missClicks>=3&&this.restartRound())},handleTimeout(){this.missClicks+=1,this.missClicks>=3&&this.restartRound()},finishRound(){this.stopTimer();const e=60-this.remainingTime;this.results.push(e),this.totalMissClicks+=this.missClicks,this.round<3?(this.round+=1,this.resetRound(),this.startTimer()):(this.currentView="result",this.saveResults())},restartRound(){this.missClicks=0,this.resetRound(),this.startTimer()},resetRound(){this.remainingTime=60,this.clickedNumbers=[],this.missClicks=0,this.round===1?(this.maxNumber=12,this.gridDimensions={rows:4,cols:3}):this.round===2?(this.maxNumber=16,this.gridDimensions={rows:4,cols:4}):(this.maxNumber=20,this.gridDimensions={rows:5,cols:4}),this.numbers=Array.from({length:this.maxNumber},(e,t)=>t+1),this.shuffledNumbers=this.shuffle([...this.numbers])},restartTest(){this.round=1,this.results=[],this.totalMissClicks=0,this.startTest()},goBack(){this.currentView="start",this.round=1,this.results=[],this.totalMissClicks=0},endTest(){this.stopTimer(),this.currentView="result"},async saveResults(){if(!this.authStore.user){alert("Пользователь не авторизован. Пожалуйста, войдите в систему.");return}const e=1,t=this.accuracy;try{const a=await fetch("http://127.0.0.1:8000/api/result/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({test:e,user:this.authStore.user.id,score_percentage:parseFloat(t)})});if(a.ok)alert("Результаты успешно сохранены!");else{const m=await a.json();alert(m.error||"Ошибка при сохранении результатов")}}catch(a){console.error("Ошибка при отправке результатов:",a)}}}},w={class:"container mt-5 text-center"},y={id:"app"},V={key:0},R={key:1},S={class:"grid"},B=["disabled","onClick"],M={class:"controls"},D={key:2};function I(e,t,a,m,n,r){const f=d("Navbar"),T=d("router-link");return u(),l(c,null,[k(f),s("div",w,[s("h2",null,o(e.$route.params.name),1),s("div",y,[n.currentView==="start"?(u(),l("div",V,[t[5]||(t[5]=s("h1",null,"Тест таблицы Шульте",-1)),s("button",{id:"start-button",onClick:t[0]||(t[0]=(...i)=>r.startTest&&r.startTest(...i))},"Начать тест")])):n.currentView==="test"?(u(),l("div",R,[s("h2",null,"Раунд "+o(n.round),1),s("p",null,"Найдите числа от 1 до "+o(n.maxNumber)+" в порядке возрастания.",1),s("p",null,"Оставшееся время: "+o(n.remainingTime)+" сек",1),s("p",null,"Количество ошибок: "+o(n.missClicks),1),s("div",S,[(u(!0),l(c,null,b(n.shuffledNumbers,i=>(u(),l("button",{key:i,disabled:n.clickedNumbers.includes(i),onClick:h=>r.checkNumber(i),class:"grid-button"},o(i),9,B))),128))]),s("div",M,[s("button",{onClick:t[1]||(t[1]=(...i)=>r.endTest&&r.endTest(...i)),id:"text"},"Завершить"),s("button",{onClick:t[2]||(t[2]=(...i)=>r.restartTest&&r.restartTest(...i)),id:"text"},"Начать заново")])])):n.currentView==="result"?(u(),l("div",D,[t[6]||(t[6]=s("h1",null,"Результаты",-1)),(u(!0),l(c,null,b(n.results,(i,h)=>(u(),l("p",{key:h}," Раунд "+o(h+1)+": "+o(i)+" сек ",1))),128)),t[7]||(t[7]=s("h2",null,"Итог:",-1)),s("p",null,"Ошибок: "+o(n.totalMissClicks),1),s("p",null,"Точность: "+o(r.accuracy)+"%",1),s("button",{onClick:t[3]||(t[3]=(...i)=>r.restartTest&&r.restartTest(...i)),id:"text"},"Повторить попытку"),s("button",{onClick:t[4]||(t[4]=(...i)=>r.goBack&&r.goBack(...i)),id:"text"},"Вернуться назад")])):N("",!0)]),k(T,{to:"/tests",class:"btn btn-secondary"},{default:g(()=>t[8]||(t[8]=[_("Назад к тестам")])),_:1})])],64)}const A=p(x,[["render",I],["__scopeId","data-v-56909e7b"]]);export{A as default};
