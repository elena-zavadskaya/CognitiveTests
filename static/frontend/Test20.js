import{_ as N,a as k,r as f,c as s,o as r,b as w,d as n,e as _,t as m,F as c,f as b,i as T,v as I,n as R,w as S,g as x,u as A}from"./index.js";const V={components:{Navbar:k},setup(){return{authStore:A()}},data(){return{stage:"intro",message:"Приготовились",currentNumber:null,currentRowNumber:null,showRowNumber:!1,results:Array.from({length:5},()=>Array(3).fill(null)),userInputs:Array.from({length:5},()=>Array(3).fill("")),isSubmitted:!1,rowIndex:0,numIndex:0,numbers:[],numbersDisplayed:!1,startTimeValue:null,time:"00:00:00"}},computed:{accuracy(){let u=0,t=this.results.length*this.results[0].length;return this.userInputs.forEach((l,d)=>{l.forEach((e,a)=>{Number(e)===this.results[d][a]&&u++})}),(u/t*100).toFixed(2)}},methods:{startTest(){const u=["Приготовились","Ряд №1"];let t=0;const l=setInterval(()=>{this.message=u[t],t++,t>=u.length&&(clearInterval(l),this.startRow())},1e3)},startRow(){if(this.rowIndex>=5){this.stage="input";return}this.stage="numbers",this.currentRowNumber=this.rowIndex+1,this.numbers=Array.from({length:4},()=>Math.floor(Math.random()*9)+1),this.results[this.rowIndex]=[this.numbers[0]+this.numbers[1],this.numbers[1]+this.numbers[2],this.numbers[2]+this.numbers[3]],this.showRowLabel()},showRowLabel(){this.showRowNumber=!0,setTimeout(()=>{this.showRowNumber=!1,setTimeout(()=>{this.showNextNumber()},1e3)},1e3)},showNextNumber(){if(this.numIndex>=this.numbers.length){this.numIndex=0,this.rowIndex++,this.rowIndex>=5&&(this.numbersDisplayed=!0),setTimeout(()=>{this.startRow()},1e3);return}this.currentNumber=this.numbers[this.numIndex],this.numIndex++,this.numIndex===1&&!this.startTimeValue&&(this.startTimeValue=Date.now()),setTimeout(()=>{this.currentNumber=null,setTimeout(()=>{this.showNextNumber()},1e3)},1e3)},submitResults(){this.isSubmitted=!0,this.time=((Date.now()-this.startTimeValue)/1e3).toFixed(2),this.saveResults()},resetTest(){this.stage="intro",this.message="Приготовились",this.rowIndex=0,this.numIndex=0,this.results=Array.from({length:5},()=>Array(3).fill(null)),this.userInputs=Array.from({length:5},()=>Array(3).fill("")),this.startTimeValue=null,this.time="0.00",this.isSubmitted=!1,this.numbersDisplayed=!1},async saveResults(){if(!this.authStore.user){alert("Пользователь не авторизован. Пожалуйста, войдите в систему.");return}const u=20,t=parseFloat(this.accuracy);if(isNaN(t)){alert("Ошибка: некорректное значение точности.");return}console.log("Отправляемые данные:",{test:u,user:this.authStore.user.id,score_percentage:t});try{const l=await fetch("http://127.0.0.1:8000/api/result/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({test:u,user:this.authStore.user.id,score_percentage:t})});if(l.ok)alert("Результаты успешно сохранены!");else{const d=await l.json();console.error("Ошибка сервера:",d),alert(d.detail||"Ошибка при сохранении результатов")}}catch(l){console.error("Ошибка при отправке результатов:",l)}}}},C={class:"memory-test"},D={key:0,class:"start-btn-container"},F={class:"screen"},B={key:0},M={key:1},E={key:0,class:"row-number"},L={key:1,class:"number"},j={key:1,class:"input-table"},z=["onUpdate:modelValue","disabled","onInput"],O=["disabled"],P={key:2,class:"results"},U={class:"result-tables"},J={class:"correct-table"},q={class:"user-table"},G={class:"accuracy"},H={class:"restart-btn-container"};function K(u,t,l,d,e,a){const g=f("Navbar"),v=f("router-link");return r(),s(c,null,[w(g),n("div",C,[n("h2",null,m(u.$route.params.name),1),t[5]||(t[5]=n("p",{class:"description"}," Внимательно смотрите на экран и запоминайте появляющиеся на нем цифры для дальнейшего сложения. Напоминаю: ваша цель сложить первую цифру со второй, вторую цифру с третьей, третью с четвертой. Результаты введите в таблицу ниже. ",-1)),e.stage==="intro"?(r(),s("div",D,[n("button",{onClick:t[0]||(t[0]=(...i)=>a.startTest&&a.startTest(...i)),class:"start-btn"},"Начать")])):_("",!0),n("div",F,[e.stage==="intro"?(r(),s("div",B,m(e.message),1)):e.stage==="numbers"?(r(),s("div",M,[e.showRowNumber?(r(),s("div",E,"Ряд №"+m(e.currentRowNumber),1)):(r(),s("div",L,m(e.currentNumber),1))])):_("",!0)]),e.stage!=="intro"?(r(),s("div",j,[n("table",null,[(r(!0),s(c,null,b(e.results,(i,o)=>(r(),s("tr",{key:"row-"+o},[(r(!0),s(c,null,b(e.results[o],(p,h)=>(r(),s("td",{key:"col-"+h},[T(n("input",{type:"number","onUpdate:modelValue":y=>e.userInputs[o][h]=y,disabled:e.isSubmitted,onInput:y=>u.startTime(o,h)},null,40,z),[[I,e.userInputs[o][h]]])]))),128))]))),128))]),n("button",{onClick:t[1]||(t[1]=(...i)=>a.submitResults&&a.submitResults(...i)),disabled:e.isSubmitted||!e.numbersDisplayed,class:"submit-btn"},"Готово",8,O)])):_("",!0),e.isSubmitted?(r(),s("div",P,[t[3]||(t[3]=n("div",{class:"result-tables"},[n("div",{class:"result-header"},"Правильный ответ"),n("div",{class:"result-header"},"Ваш ответ")],-1)),n("div",U,[n("table",J,[(r(!0),s(c,null,b(e.results,(i,o)=>(r(),s("tr",{key:"result-row-"+o},[(r(!0),s(c,null,b(i,(p,h)=>(r(),s("td",{key:"correct-"+h},m(p),1))),128))]))),128))]),n("table",q,[(r(!0),s(c,null,b(e.userInputs,(i,o)=>(r(),s("tr",{key:"input-row-"+o},[(r(!0),s(c,null,b(i,(p,h)=>(r(),s("td",{key:"input-"+h,class:R({correct:p==e.results[o][h]})},m(p),3))),128))]))),128))])]),n("div",G,[n("p",null,"Точность: "+m(a.accuracy)+"%",1),n("p",null,"Время выполнения: "+m(e.time)+" секунд",1)]),n("div",H,[n("button",{onClick:t[2]||(t[2]=(...i)=>a.resetTest&&a.resetTest(...i)),class:"restart-btn"},"Начать заново")])])):_("",!0),w(v,{to:"/tests",class:"btn btn-secondary"},{default:S(()=>t[4]||(t[4]=[x("Назад к тестам")])),_:1})])],64)}const W=N(V,[["render",K],["__scopeId","data-v-e8245965"]]);export{W as default};
