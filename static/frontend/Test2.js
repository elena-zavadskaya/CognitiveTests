import{_ as k,a as w,r as d,c as u,o as a,b as g,d as e,t as c,e as l,F as m,f as y,w as _,g as v,u as b}from"./index.js";const T={components:{Navbar:w},setup(){return{authStore:b()}},data(){return{currentView:"start",round:1,remainingTime:5,currentDigit:null,showDigit:!1,accuracy:0,results:[],userInput:""}},methods:{startTest(){this.currentView="test",this.startRound()},startRound(){this.round>4?this.currentDigit=Math.floor(Math.random()*90)+10:this.currentDigit=Math.floor(Math.random()*10),this.showDigit=!0,this.userInput="",this.remainingTime=3;let n=setInterval(()=>{this.remainingTime--,this.remainingTime<=0&&(clearInterval(n),this.showDigit=!1)},1e3)},checkAnswer(n){this.showDigit||(this.userInput+=n,this.round>4?this.userInput.length===2&&(parseInt(this.userInput)===this.currentDigit?this.accuracy=100:this.accuracy=0,this.endRound()):parseInt(this.userInput)===this.currentDigit&&(this.accuracy=100,this.endRound()))},endRound(){this.results.push(this.accuracy),this.round<7?(this.round++,this.startRound()):(this.currentView="result",this.saveResults())},restartTest(){this.round=1,this.results=[],this.accuracy=0,this.userInput="",this.currentView="start"},goBack(){this.currentView="start"},async saveResults(){if(!this.authStore.user){alert("Пользователь не авторизован. Пожалуйста, войдите в систему.");return}const n=2,t=this.calculateAverageAccuracy();try{const o=await fetch("http://127.0.0.1:8000/api/result/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({test:n,user:this.authStore.user.id,score_percentage:parseFloat(t)})});if(o.ok)alert("Результаты успешно сохранены!");else{const h=await o.json();alert(h.error||"Ошибка при сохранении результатов")}}catch(o){console.error("Ошибка при отправке результатов:",o)}},calculateAverageAccuracy(){return this.results.length===0?0:(this.results.reduce((t,o)=>t+o,0)/this.results.length).toFixed(2)}}},D={class:"container mt-5 text-center"},I={id:"app"},V={key:0},C={key:1},A={class:"digit-to-remember"},S={key:0},N={key:0,class:"buttons"},R=["onClick"],B={key:2};function x(n,t,o,h,s,i){const p=d("Navbar"),f=d("router-link");return a(),u(m,null,[g(p),e("div",D,[e("h2",null,c(n.$route.params.name),1),e("div",I,[s.currentView==="start"?(a(),u("div",V,[t[4]||(t[4]=e("h1",null,"Тест числового охвата",-1)),e("button",{id:"start-button",onClick:t[0]||(t[0]=(...r)=>i.startTest&&i.startTest(...r))},"Начать тест")])):s.currentView==="test"?(a(),u("div",C,[e("h2",null,"Раунд "+c(s.round),1),t[5]||(t[5]=e("p",null,"Запомните число, а затем выберите его на клавиатуре.",-1)),e("p",null,"Загаданное число исчезнет через: "+c(s.remainingTime)+" сек",1),e("div",A,[s.showDigit?(a(),u("span",S,c(s.currentDigit),1)):l("",!0)]),s.showDigit?l("",!0):(a(),u("div",N,[(a(),u(m,null,y(9,r=>e("button",{key:r,onClick:F=>i.checkAnswer(r)},c(r),9,R)),64)),e("button",{onClick:t[1]||(t[1]=r=>i.checkAnswer(0))},"0")]))])):s.currentView==="result"?(a(),u("div",B,[t[6]||(t[6]=e("h1",null,"Результаты",-1)),e("p",null,"Раунд "+c(s.round)+" завершён!",1),e("p",null,"Точность: "+c(s.accuracy)+"%",1),e("button",{onClick:t[2]||(t[2]=(...r)=>i.restartTest&&i.restartTest(...r))},"Повторить"),e("button",{onClick:t[3]||(t[3]=(...r)=>i.goBack&&i.goBack(...r))},"Назад")])):l("",!0)]),g(f,{to:"/tests",class:"btn btn-secondary"},{default:_(()=>t[7]||(t[7]=[v("Назад к тестам")])),_:1})])],64)}const j=k(T,[["render",x],["__scopeId","data-v-540ebf35"]]);export{j as default};
