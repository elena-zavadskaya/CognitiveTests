import{_ as f,a as k,r as d,c as r,o,b as u,d as l,t as h,e as n,F as _,f as v,h as x,w as b,g as E,u as I}from"./index.js";const C="/img_1.png",N="/img_2.png",G="/img_3.png",T="/img_4.png",w="/img_5.png",B="/img_6.png",F="/img_7.png",R="/img_8.png",V={components:{Navbar:k},setup(){return{authStore:I()}},data(){return{images:[{src:C,correctSpot:{x:210,y:70}},{src:N,correctSpot:{x:60,y:25}},{src:G,correctSpot:{x:245,y:60}},{src:T,correctSpot:{x:150,y:80}},{src:w,correctSpot:{x:100,y:155}},{src:B,correctSpot:{x:240,y:90}},{src:F,correctSpot:{x:25,y:70}},{src:R,correctSpot:{x:260,y:135}}],highlightedSpots:{},gameEnded:!1,gameStarted:!1,timer:60,totalSpots:8,foundSpots:0,time:0,accuracy:0}},methods:{startGame(){this.gameStarted=!0,this.gameEnded=!1,this.timer=60,this.time=0,this.highlightedSpots={},this.foundSpots=0,this.startTimer()},checkSpot(c,e){const a=e.target.getBoundingClientRect(),m=e.clientX-a.left,t=e.clientY-a.top,s=this.images[c].correctSpot,i=30;m>=s.x-i&&m<=s.x+i&&t>=s.y-i&&t<=s.y+i&&(this.highlightedSpots[c]||(this.highlightedSpots={...this.highlightedSpots,[c]:{style:{position:"absolute",left:`${s.x-i}px`,top:`${s.y-i}px`,width:`${i*2}px`,height:`${i*2}px`,border:"2px solid red",borderRadius:"50%",pointerEvents:"none"}}},this.foundSpots++,this.checkGameEnd()))},checkGameEnd(){(this.foundSpots===this.totalSpots||this.timer<=0)&&(this.gameEnded=!0,clearInterval(this.timerInterval),this.timer<=0?this.time=60:this.time=60-this.timer,this.accuracy=(this.foundSpots/this.totalSpots*100).toFixed(2),this.saveResults())},startTimer(){this.timerInterval=setInterval(()=>{this.timer>0?this.timer--:(this.gameEnded=!0,clearInterval(this.timerInterval),this.time=60)},1e3)},async saveResults(){if(!this.authStore.user){alert("Пользователь не авторизован. Пожалуйста, войдите в систему.");return}const c=14,e=parseFloat(this.accuracy);try{const a=await fetch("http://127.0.0.1:8000/api/result/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({test:c,user:this.authStore.user.id,score_percentage:e})});if(a.ok)alert("Результаты успешно сохранены!");else{const m=await a.json();alert(m.error||"Ошибка при сохранении результатов")}}catch(a){console.error("Ошибка при отправке результатов:",a)}}},mounted(){this.startTimer()},beforeUnmount(){clearInterval(this.timerInterval)}},j={class:"container mt-5 text-center"},z={id:"app"},A={class:"image-checker"},D={key:1},O={class:"image-container-wrapper"},P=["src","onClick"],X={key:0},Y={key:1},J={key:2},L={key:3},M={key:4};function U(c,e,a,m,t,s){const i=d("Navbar"),S=d("router-link");return o(),r(_,null,[u(i),l("div",j,[l("h2",null,h(c.$route.params.name),1),l("div",z,[l("div",A,[e[3]||(e[3]=l("h2",null,"Найдите неточность на картинке",-1)),t.gameStarted?n("",!0):(o(),r("button",{key:0,onClick:e[0]||(e[0]=(...g)=>s.startGame&&s.startGame(...g))},"Начать игру")),t.gameStarted?(o(),r("div",D,[l("div",O,[(o(!0),r(_,null,v(t.images,(g,p)=>(o(),r("div",{key:p,class:"image-container"},[l("img",{src:g.src,onClick:y=>s.checkSpot(p,y)},null,8,P),t.highlightedSpots[p]?(o(),r("div",{key:0,class:"highlight",style:x(t.highlightedSpots[p].style)},null,4)):n("",!0)]))),128))]),t.gameEnded?n("",!0):(o(),r("p",X,h(t.timer)+" секунд осталось",1)),t.gameEnded?(o(),r("p",Y,"Игра окончена!")):n("",!0),t.gameEnded?(o(),r("p",J,"Вы нашли "+h(t.foundSpots)+" из "+h(t.totalSpots)+" отличий.",1)):n("",!0),t.gameEnded?(o(),r("p",L,"Время, затраченное на игру: "+h(t.time)+" секунд.",1)):n("",!0),t.gameEnded?(o(),r("p",M,"Процент прохождения игры: "+h(t.accuracy)+"%",1)):n("",!0),t.gameEnded?(o(),r("button",{key:5,onClick:e[1]||(e[1]=(...g)=>s.startGame&&s.startGame(...g))},"Начать заново")):n("",!0)])):n("",!0),e[4]||(e[4]=l("br",null,null,-1)),u(S,{to:"/tests",class:"btn btn-secondary"},{default:b(()=>e[2]||(e[2]=[E("Назад к тестам")])),_:1})])])])],64)}const H=f(V,[["render",U]]);export{H as default};
