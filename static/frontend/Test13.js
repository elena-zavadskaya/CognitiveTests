import{_ as y,a as S,r as m,c as a,o as n,b as v,d as s,t as l,g as u,e as d,F as g,f as M,h as B,w as k,u as _}from"./index.js";const I={components:{Navbar:S},setup(){return{authStore:_()}},data(){return{gameStarted:!1,balls:[{x:140,y:0,color:this.getRandomColor(),moving:!0,direction:"down"},{x:0,y:140,color:this.getRandomColor(),moving:!0,direction:"right"}],score:0,speed:2,interval:null,nextBallIndex:0,resultMessage:"",finalMessage:"",level:1,time:0,accuracy:0,gameStartTime:null}},methods:{startGame(){this.gameStarted=!0,this.score=0,this.level=1,this.speed=2,this.gameStartTime=Date.now(),this.balls.forEach((e,t)=>{e.x=t===0?140:0,e.y=t===0?0:140,e.moving=!0}),this.nextBallIndex=0,this.resultMessage="",this.finalMessage="",this.startInterval()},startInterval(){this.interval=setInterval(()=>{this.moveBalls(),this.time=((Date.now()-this.gameStartTime)/1e3).toFixed(1)},50)},moveBalls(){this.balls.forEach(e=>{e.moving&&(e.direction==="down"?(e.y+=this.speed,e.y>300&&(e.y=0)):e.direction==="up"&&(e.y-=this.speed,e.y<0&&(e.y=300)),e.direction==="right"?(e.x+=this.speed,e.x>300&&(e.x=0)):e.direction==="left"&&(e.x-=this.speed,e.x<0&&(e.x=300)))})},stopNextBall(){if(this.nextBallIndex<this.balls.length){const e=this.balls[this.nextBallIndex];e.moving=!1,this.calculateScore(),this.nextBallIndex++,this.nextBallIndex===this.balls.length&&(this.displayResult(),this.nextLevel())}},calculateScore(){this.balls.forEach(o=>{const h=Math.sqrt((o.x-140)**2+(o.y-140)**2);this.score+=Math.max(0,100-h)})},displayResult(){this.score>1100?(this.resultMessage="Отличный уровень координации",this.accuracy=100):this.score>=1e3?(this.resultMessage="Средний уровень координации",this.accuracy=75):(this.resultMessage="Нуждается в улучшении",this.accuracy=50)},nextLevel(){this.level<3?(this.level++,this.speed+=1,this.resetGame()):(this.finalMessage="Игра завершена! Ваш финальный счет: "+this.score,clearInterval(this.interval),this.saveResults())},resetGame(){this.balls.forEach((e,t)=>{e.x=t===0?140:0,e.y=t===0?0:140,e.moving=!0}),this.nextBallIndex=0,this.resultMessage=""},restartGame(){this.startGame()},getRandomColor(){const e="0123456789ABCDEF";let t="#";for(let o=0;o<6;o++)t+=e[Math.floor(Math.random()*16)];return t},async saveResults(){if(!this.authStore.user){alert("Пользователь не авторизован. Пожалуйста, войдите в систему.");return}const e=13,t=this.accuracy;console.log("Отправляемые данные:",{test:e,user:this.authStore.user.id,score_percentage:parseFloat(t)});try{const o=await fetch("http://127.0.0.1:8000/api/result/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({test:e,user:this.authStore.user.id,score_percentage:parseFloat(t)})}),h=await o.json();if(console.log("Ответ сервера:",h),o.ok)alert("Результаты успешно сохранены!");else{const r=await o.json();alert(r.error||"Ошибка при сохранении результатов")}}catch(o){console.error("Ошибка при отправке результатов:",o)}}},mounted(){},beforeUnmount(){clearInterval(this.interval)}},C={class:"container mt-5 text-center"},N={id:"app"},w={key:0},G={key:1},R={class:"score"},T={class:"level"},D={key:0,class:"result"},E={key:1,class:"final-result"};function F(e,t,o,h,r,c){const f=m("Navbar"),p=m("router-link");return n(),a(g,null,[v(f),s("div",C,[s("h2",null,l(e.$route.params.name),1),s("div",N,[s("div",null,[r.gameStarted?(n(),a("div",G,[s("div",{class:"game-container",onClick:t[1]||(t[1]=(...i)=>c.stopNextBall&&c.stopNextBall(...i))},[t[5]||(t[5]=s("div",{class:"line vertical"},null,-1)),t[6]||(t[6]=s("div",{class:"line horizontal"},null,-1)),(n(!0),a(g,null,M(r.balls,(i,x)=>(n(),a("div",{key:x,class:"ball",style:B({left:i.x+"px",top:i.y+"px",backgroundColor:i.color})},null,4))),128)),s("div",R,"Score: "+l(r.score),1),s("div",T,"Level: "+l(r.level),1)]),r.resultMessage?(n(),a("div",D,l(r.resultMessage),1)):d("",!0),r.finalMessage?(n(),a("div",E,[u(l(r.finalMessage)+" ",1),s("p",null,"Время выполнения теста: "+l(r.time)+" секунд",1),s("p",null,"Точность: "+l(r.accuracy)+"%",1)])):d("",!0),r.finalMessage?(n(),a("button",{key:2,onClick:t[2]||(t[2]=(...i)=>c.restartGame&&c.restartGame(...i)),class:"restart-button"},"Начать заново")):d("",!0)])):(n(),a("div",w,[t[3]||(t[3]=s("h2",null,"Тест на зрительно-моторную координацию",-1)),t[4]||(t[4]=s("p",null,[u("В каждом раунде ты увидишь два шарика. Шарики будут двигаться вдоль своей оси, "),s("br"),u(" и твоя цель - заставить их остановиться как можно ближе к пересечению линий.")],-1)),s("button",{onClick:t[0]||(t[0]=(...i)=>c.startGame&&c.startGame(...i)),class:"start-button"},"Начать игру")])),t[8]||(t[8]=s("br",null,null,-1)),t[9]||(t[9]=u()),v(p,{to:"/tests",class:"btn btn-secondary"},{default:k(()=>t[7]||(t[7]=[u("Назад к тестам")])),_:1})])])])],64)}const V=y(I,[["render",F],["__scopeId","data-v-0882e352"]]);export{V as default};
