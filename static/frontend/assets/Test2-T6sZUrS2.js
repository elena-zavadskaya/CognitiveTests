import{_ as p,a as b,r as m,c as a,o as u,b as d,d as e,t as i,e as c,F as _,f,w as k,g as v,u as T}from"./index-BFI9Nzsh.js";const S={components:{Navbar:b},setup(){return{authStore:T()}},data(){return{currentView:"start",round:1,remainingTime:5,currentDigit:null,showDigit:!1,userInput:"",totalTime:0,number_all_answers:7,number_correct_answers:0}},computed:{time(){return this.formatTime(this.totalTime)},accuracy(){if(this.number_all_answers===0)return 0;const r=this.number_correct_answers/this.number_all_answers*100;return Math.round(r)}},methods:{formatTime(r){const t=Math.floor(r/3600),l=Math.floor(r%3600/60),h=r%60;return`${String(t).padStart(2,"0")}:${String(l).padStart(2,"0")}:${String(h).padStart(2,"0")}`},startTest(){this.currentView="test",this.startRound()},startRound(){this.currentDigit=this.round>4?Math.floor(Math.random()*90)+10:Math.floor(Math.random()*10),this.showDigit=!0,this.userInput="",this.remainingTime=3;const r=setInterval(()=>{this.remainingTime--,this.remainingTime<=0&&(clearInterval(r),this.showDigit=!1)},1e3)},checkAnswer(r){if(this.showDigit)return;this.userInput+=r.toString();const t=this.round>4?2:1;this.userInput.length===t&&(parseInt(this.userInput)===this.currentDigit&&(this.number_correct_answers+=1),this.endRound())},endRound(){this.totalTime+=3-this.remainingTime,this.round<7?(this.round++,this.startRound()):(this.currentView="result",this.saveResults())},restartTest(){this.round=1,this.number_correct_answers=0,this.totalTime=0,this.currentView="start"},goBack(){this.$router.push("/tests")},async saveResults(){if(!this.authStore.user){alert("Для сохранения результатов необходимо авторизоваться");return}try{const r={test:2,user:this.authStore.user.id,score_percentage:this.accuracy,time:this.time,number_all_answers:this.number_all_answers,number_correct_answers:this.number_correct_answers};console.log("Saving results:",r);const t=await fetch("/api/result/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(r)}),l=await t.json();if(console.log("Server response:",l),!t.ok)throw new Error(l.error||"Unknown server error");alert("Результаты успешно сохранены!")}catch(r){console.error("Save error:",r),alert(`Ошибка сохранения: ${r.message}`)}}}},y={class:"container mt-5 text-center"},D={id:"app"},V={key:0},C={key:1},I={class:"digit-to-remember"},N={key:0},A={key:0,class:"buttons"},B=["onClick"],M={key:2};function R(r,t,l,h,s,n){const w=m("Navbar"),g=m("router-link");return u(),a(_,null,[d(w),e("div",y,[e("h2",null,i(r.$route.params.name),1),e("div",D,[s.currentView==="start"?(u(),a("div",V,[t[4]||(t[4]=e("h1",null,"Тест числового охвата",-1)),e("button",{id:"start-button",onClick:t[0]||(t[0]=(...o)=>n.startTest&&n.startTest(...o))},"Начать тест")])):s.currentView==="test"?(u(),a("div",C,[e("h2",null,"Раунд "+i(s.round),1),t[5]||(t[5]=e("p",null,"Запомните число, а затем выберите его на клавиатуре.",-1)),e("p",null,"Загаданное число исчезнет через: "+i(s.remainingTime)+" сек",1),e("div",I,[s.showDigit?(u(),a("span",N,i(s.currentDigit),1)):c("",!0)]),s.showDigit?c("",!0):(u(),a("div",A,[(u(),a(_,null,f(9,o=>e("button",{key:o,onClick:x=>n.checkAnswer(o)},i(o),9,B)),64)),e("button",{onClick:t[1]||(t[1]=o=>n.checkAnswer(0))},"0")]))])):s.currentView==="result"?(u(),a("div",M,[t[6]||(t[6]=e("h1",null,"Результаты",-1)),e("p",null,"Раунд "+i(s.round)+" завершён!",1),e("p",null,"Точность: "+i(n.accuracy)+"%",1),e("p",null,"Время: "+i(n.time),1),e("p",null,"Вопросов: "+i(s.number_all_answers),1),e("p",null,"Верных ответов: "+i(s.number_correct_answers),1),e("button",{onClick:t[2]||(t[2]=(...o)=>n.restartTest&&n.restartTest(...o))},"Повторить"),e("button",{onClick:t[3]||(t[3]=(...o)=>n.goBack&&n.goBack(...o))},"Назад")])):c("",!0)]),d(g,{to:"/tests",class:"btn btn-secondary"},{default:k(()=>t[7]||(t[7]=[v("Назад к тестам")])),_:1})])],64)}const E=p(S,[["render",R],["__scopeId","data-v-7c580f7a"]]);export{E as default};
