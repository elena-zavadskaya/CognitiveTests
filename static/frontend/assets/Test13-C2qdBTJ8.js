import{_ as x,a as y,r as d,c as i,o,b as g,d as s,t as l,g as h,e as m,F as v,f as b,h as w,w as M,u as S}from"./index-BFI9Nzsh.js";const B={components:{Navbar:y},setup(){return{authStore:S()}},data(){return{gameStarted:!1,balls:[{x:140,y:0,color:this.getRandomColor(),moving:!0,direction:"down"},{x:0,y:140,color:this.getRandomColor(),moving:!0,direction:"right"}],score:0,speed:2,interval:null,nextBallIndex:0,resultMessage:"",finalMessage:"",level:1,time:"00:00:00",number_all_answers:0,number_correct_answers:0,accuracy:0,gameStartTime:null}},methods:{startGame(){this.gameStarted=!0,this.score=0,this.level=1,this.speed=2,this.gameStartTime=Date.now(),this.number_all_answers=0,this.number_correct_answers=0,this.balls.forEach((t,e)=>{t.x=e===0?140:0,t.y=e===0?0:140,t.moving=!0}),this.nextBallIndex=0,this.resultMessage="",this.finalMessage="",this.startInterval()},startInterval(){this.interval=setInterval(()=>{this.moveBalls(),this.time=this.formatTime(Math.floor((Date.now()-this.gameStartTime)/1e3))},50)},moveBalls(){this.balls.forEach(t=>{t.moving&&(t.direction==="down"&&(t.y+=this.speed,t.y>300&&(t.y=0)),t.direction==="right"&&(t.x+=this.speed,t.x>300&&(t.x=0)))})},stopNextBall(){if(this.nextBallIndex<this.balls.length){const t=this.balls[this.nextBallIndex];t.moving=!1,this.number_all_answers++,this.isAccurate(t)&&this.number_correct_answers++,this.calculateScore(),this.nextBallIndex++,this.nextBallIndex===this.balls.length&&(this.displayResult(),this.nextLevel())}},isAccurate(t){return Math.sqrt((t.x-140)**2+(t.y-140)**2)<=10},calculateScore(){this.balls.forEach(n=>{const u=Math.sqrt((n.x-140)**2+(n.y-140)**2);this.score+=Math.max(0,100-u)})},displayResult(){this.accuracy=(this.number_correct_answers/this.number_all_answers*100).toFixed(2),this.score>1100?this.resultMessage="Отличный уровень координации!":this.score>=1e3?this.resultMessage="Средний уровень координации.":this.resultMessage="Координация нуждается в улучшении."},nextLevel(){this.level<3?(this.level++,this.speed+=1,this.resetGame()):(this.finalMessage=`Игра завершена! Ваш финальный счет: ${this.score}`,clearInterval(this.interval),this.saveResults())},formatTime(t){const e=String(Math.floor(t/60)).padStart(2,"0"),n=String(t%60).padStart(2,"0");return`00:${e}:${n}`},resetGame(){this.balls.forEach((t,e)=>{t.x=e===0?140:0,t.y=e===0?0:140,t.moving=!0}),this.nextBallIndex=0,this.resultMessage=""},restartGame(){this.startGame()},getRandomColor(){const t="0123456789ABCDEF";let e="#";for(let n=0;n<6;n++)e+=t[Math.floor(Math.random()*16)];return e},async saveResults(){if(!this.authStore.user){alert("Пользователь не авторизован. Пожалуйста, войдите в систему.");return}const t=13,e=this.accuracy;try{await fetch("http://127.0.0.1:8000/api/result/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({test:t,user:this.authStore.user.id,score_percentage:Math.round(e),time:this.time,number_all_answers:this.number_all_answers,number_correct_answers:this.number_correct_answers})}),alert("Результаты успешно сохранены!")}catch(n){console.error("Ошибка при отправке результатов:",n)}}},beforeUnmount(){clearInterval(this.interval)}},k={class:"container mt-5 text-center"},I={id:"app"},C={key:0},N={key:1},G={class:"score"},T={class:"level"},R={key:0,class:"result mt-3"},E={key:1,class:"final-result mt-3"};function A(t,e,n,u,r,c){const f=d("Navbar"),_=d("router-link");return o(),i(v,null,[g(f),s("div",k,[s("h2",null,l(t.$route.params.name),1),s("div",I,[s("div",null,[r.gameStarted?(o(),i("div",N,[s("div",{class:"game-container",onClick:e[1]||(e[1]=(...a)=>c.stopNextBall&&c.stopNextBall(...a))},[e[6]||(e[6]=s("div",{class:"line vertical"},null,-1)),e[7]||(e[7]=s("div",{class:"line horizontal"},null,-1)),(o(!0),i(v,null,b(r.balls,(a,p)=>(o(),i("div",{key:p,class:"ball",style:w({left:a.x+"px",top:a.y+"px",backgroundColor:a.color})},null,4))),128)),s("div",G,"Очки: "+l(r.score),1),s("div",T,"Уровень: "+l(r.level),1)]),r.resultMessage?(o(),i("div",R,l(r.resultMessage),1)):m("",!0),r.finalMessage?(o(),i("div",E,[s("h3",null,l(r.finalMessage),1),s("p",null,"Время выполнения теста: "+l(r.time),1),s("p",null,"Точность: "+l(r.accuracy)+"%",1),s("p",null,"Попаданий в центр: "+l(r.number_correct_answers),1),s("p",null,"Общее количество попыток: "+l(r.number_all_answers),1)])):m("",!0),r.finalMessage?(o(),i("button",{key:2,onClick:e[2]||(e[2]=(...a)=>c.restartGame&&c.restartGame(...a)),class:"restart-button btn btn-warning mt-3"},"Начать заново")):m("",!0)])):(o(),i("div",C,[e[3]||(e[3]=s("h2",null,"Тест на зрительно-моторную координацию",-1)),e[4]||(e[4]=s("p",null,"В каждом раунде ты увидишь два шарика. Они будут двигаться вдоль своей оси.",-1)),e[5]||(e[5]=s("p",null,[s("strong",null,"Цель:"),h(" заставить их остановиться как можно ближе к пересечению линий.")],-1)),s("button",{onClick:e[0]||(e[0]=(...a)=>c.startGame&&c.startGame(...a)),class:"start-button btn btn-primary"},"Начать игру")])),e[9]||(e[9]=s("br",null,null,-1)),e[10]||(e[10]=h()),g(_,{to:"/tests",class:"btn btn-secondary mt-3"},{default:M(()=>e[8]||(e[8]=[h("Назад к тестам")])),_:1})])])])],64)}const F=x(B,[["render",A],["__scopeId","data-v-53c889e2"]]);export{F as default};
