import{_ as p,a as T,r as b,c as l,o as u,b as f,d as s,t as o,e as g,F as k,f as _,w as N,g as w,u as C}from"./index-BFI9Nzsh.js";const S={components:{Navbar:T},setup(){return{authStore:C()}},data(){return{currentView:"start",round:1,timer:null,remainingTime:60,maxNumber:12,numbers:[],shuffledNumbers:[],clickedNumbers:[],results:[],missClicks:0,totalMissClicks:0,gridDimensions:{rows:4,cols:3},time:"00:00:00",number_all_answers:48}},computed:{accuracy(){const e=this.round*this.maxNumber;return e>0?((e-this.totalMissClicks)/e*100).toFixed(2):0},number_correct_answers(){return this.number_all_answers-this.totalMissClicks}},methods:{addTime(e){const[t,a,m]=this.time.split(":").map(Number);let r=t*3600+a*60+m;r+=e;const n=Math.floor(r/3600),c=Math.floor(r%3600/60),h=r%60;this.time=`${String(n).padStart(2,"0")}:${String(c).padStart(2,"0")}:${String(h).padStart(2,"0")}`},startTest(){this.resetRound(),this.currentView="test",this.startTimer()},startTimer(){this.stopTimer(),this.timer=setInterval(()=>{this.remainingTime--,this.remainingTime<=0&&this.handleTimeout()},1e3)},stopTimer(){this.timer&&(clearInterval(this.timer),this.timer=null)},shuffle(e){return e.sort(()=>Math.random()-.5)},checkNumber(e){e===this.clickedNumbers.length+1?(this.clickedNumbers.push(e),this.clickedNumbers.length===this.maxNumber&&this.finishRound()):(this.missClicks+=1,this.missClicks>=3&&this.restartRound())},handleTimeout(){this.missClicks+=1,this.missClicks>=3&&this.restartRound()},finishRound(){this.stopTimer();const e=60-this.remainingTime;this.totalMissClicks+=this.missClicks,this.addTime(e),this.round<3?(this.round+=1,this.resetRound(),this.startTimer()):(this.currentView="result",this.saveResults())},restartRound(){this.missClicks=0,this.resetRound(),this.startTimer()},resetRound(){this.remainingTime=60,this.clickedNumbers=[],this.missClicks=0,this.round===1?(this.maxNumber=12,this.gridDimensions={rows:4,cols:3}):this.round===2?(this.maxNumber=16,this.gridDimensions={rows:4,cols:4}):(this.maxNumber=20,this.gridDimensions={rows:5,cols:4}),this.numbers=Array.from({length:this.maxNumber},(e,t)=>t+1),this.shuffledNumbers=this.shuffle([...this.numbers])},restartTest(){this.round=1,this.totalMissClicks=0,this.time="00:00:00",this.startTest()},goBack(){this.currentView="start",this.round=1,this.totalMissClicks=0,this.time="00:00:00"},async saveResults(){if(!this.authStore.user){alert("Пользователь не авторизован. Пожалуйста, войдите в систему.");return}const e=1,t=this.accuracy;try{const a=await fetch("http://127.0.0.1:8000/api/result/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({test:e,user:this.authStore.user.id,score_percentage:parseInt(t,10),time:this.time,number_correct_answers:this.number_correct_answers,number_all_answers:this.number_all_answers,accuracy:parseInt(t,10)})});if(a.ok)alert("Результаты успешно сохранены!");else{const m=await a.json();alert(m.error||"Ошибка при сохранении результатов")}}catch(a){console.error("Ошибка при отправке результатов:",a)}}}},v={class:"container mt-5 text-center"},y={id:"app"},x={key:0},M={key:1},R={class:"grid"},V=["disabled","onClick"],B={class:"controls"},I={key:2};function D(e,t,a,m,r,n){const c=b("Navbar"),h=b("router-link");return u(),l(k,null,[f(c),s("div",v,[s("h2",null,o(e.$route.params.name),1),s("div",y,[r.currentView==="start"?(u(),l("div",x,[t[4]||(t[4]=s("h1",null,"Тест таблицы Шульте",-1)),s("button",{id:"start-button",onClick:t[0]||(t[0]=(...i)=>n.startTest&&n.startTest(...i))},"Начать тест")])):r.currentView==="test"?(u(),l("div",M,[s("h2",null,"Раунд "+o(r.round),1),s("p",null,"Найдите числа от 1 до "+o(r.maxNumber)+" в порядке возрастания.",1),s("p",null,"Оставшееся время: "+o(r.remainingTime)+" сек",1),s("p",null,"Количество ошибок: "+o(r.missClicks),1),s("div",R,[(u(!0),l(k,null,_(r.shuffledNumbers,i=>(u(),l("button",{key:i,disabled:r.clickedNumbers.includes(i),onClick:d=>n.checkNumber(i),class:"grid-button"},o(i),9,V))),128))]),s("div",B,[s("button",{onClick:t[1]||(t[1]=(...i)=>n.restartTest&&n.restartTest(...i)),id:"text"},"Начать заново")])])):r.currentView==="result"?(u(),l("div",I,[t[5]||(t[5]=s("h1",null,"Результаты",-1)),(u(!0),l(k,null,_(r.results,(i,d)=>(u(),l("p",{key:d}," Раунд "+o(d+1)+": "+o(e.formatTime(i))+" сек ",1))),128)),t[6]||(t[6]=s("h2",null,"Итог:",-1)),s("p",null,"Ошибок: "+o(r.totalMissClicks),1),s("p",null,"Точность: "+o(n.accuracy)+"%",1),s("p",null,"Время: "+o(r.time),1),s("p",null,"Вопросов: "+o(r.number_all_answers),1),s("p",null,"Верных ответов: "+o(n.number_correct_answers),1),s("button",{onClick:t[2]||(t[2]=(...i)=>n.restartTest&&n.restartTest(...i)),id:"text"},"Повторить попытку"),s("button",{onClick:t[3]||(t[3]=(...i)=>n.goBack&&n.goBack(...i)),id:"text"},"Вернуться назад")])):g("",!0)]),f(h,{to:"/tests",class:"btn btn-secondary"},{default:N(()=>t[7]||(t[7]=[w("Назад к тестам")])),_:1})])],64)}const F=p(S,[["render",D],["__scopeId","data-v-f8f9c986"]]);export{F as default};
