import{_ as b,a as f,r as _,c as n,o as i,b as d,d as m,t as h,e as a,F as p,f as k,h as w,w as x,g as v,u as E}from"./index-BFI9Nzsh.js";const G="/assets/img_1-Bu8nA-jD.png",C="/assets/img_2-Dfn2sxn3.png",B="/assets/img_3-Bloq5hWG.png",T="/assets/img_4-BMyXpMeS.png",I="/assets/img_5-BSc5ZER4.png",N="/assets/img_6-5f5BToEa.png",M="/assets/img_7-DtkgV7qJ.png",R="/assets/img_8-6sblCxc7.png",V={components:{Navbar:f},setup(){return{authStore:E()}},data(){return{images:[{src:G,correctSpot:{x:210,y:70}},{src:C,correctSpot:{x:60,y:25}},{src:B,correctSpot:{x:245,y:60}},{src:T,correctSpot:{x:150,y:80}},{src:I,correctSpot:{x:100,y:155}},{src:N,correctSpot:{x:240,y:90}},{src:M,correctSpot:{x:25,y:70}},{src:R,correctSpot:{x:260,y:135}}],highlightedSpots:{},gameEnded:!1,gameStarted:!1,timer:60,time:"00:00:00",accuracy:0,number_all_answers:0,number_correct_answers:0}},methods:{startGame(){this.gameStarted=!0,this.gameEnded=!1,this.timer=60,this.time="00:00:00",this.highlightedSpots={},this.number_correct_answers=0,this.number_all_answers=this.images.length,this.startTimer()},checkSpot(r,t){if(this.gameEnded)return;const c=t.target.getBoundingClientRect(),u=t.clientX-c.left,e=t.clientY-c.top,s=this.images[r].correctSpot,o=30;u>=s.x-o&&u<=s.x+o&&e>=s.y-o&&e<=s.y+o&&(this.highlightedSpots[r]||(this.highlightedSpots={...this.highlightedSpots,[r]:{style:{position:"absolute",left:`${s.x-o}px`,top:`${s.y-o}px`,width:`${o*2}px`,height:`${o*2}px`,border:"2px solid red",borderRadius:"50%",pointerEvents:"none"}}},this.number_correct_answers++)),this.checkGameEnd()},checkGameEnd(){(this.number_correct_answers===this.number_all_answers||this.timer<=0)&&this.endGame()},startTimer(){this.timerInterval=setInterval(()=>{this.timer>0?this.timer--:this.endGame()},1e3)},endGame(){if(this.gameEnded)return;this.gameEnded=!0,clearInterval(this.timerInterval);const r=60-this.timer;this.time=this.formatTime(r),this.accuracy=this.number_all_answers>0?(this.number_correct_answers/this.number_all_answers*100).toFixed(2):"0.00",this.saveResults()},formatTime(r){const t=String(Math.floor(r/60)).padStart(2,"0"),c=String(r%60).padStart(2,"0");return`00:${t}:${c}`},async saveResults(){if(!this.authStore.user){alert("Пользователь не авторизован. Пожалуйста, войдите в систему.");return}const r=14,t=this.accuracy;try{(await fetch("http://127.0.0.1:8000/api/result/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({test:r,user:this.authStore.user.id,score_percentage:Math.round(t),time:this.time,number_all_answers:this.number_all_answers,number_correct_answers:this.number_correct_answers})})).ok?alert("Результаты успешно сохранены!"):alert("Ошибка при сохранении результатов")}catch(c){console.error("Ошибка при отправке результатов:",c)}}},beforeUnmount(){clearInterval(this.timerInterval)}},D={class:"container mt-5 text-center"},A={id:"app"},F={class:"image-checker"},X={key:2},j={class:"image-container-wrapper"},q=["src","onClick"],z={key:0},J={key:1},O={key:2},P={key:3},Y={key:4};function L(r,t,c,u,e,s){const o=_("Navbar"),S=_("router-link");return i(),n(p,null,[d(o),m("div",D,[m("h2",null,h(r.$route.params.name),1),m("div",A,[m("div",F,[t[4]||(t[4]=m("h2",null,"Найдите неточность на картинке",-1)),e.gameStarted?a("",!0):(i(),n("button",{key:0,onClick:t[0]||(t[0]=(...l)=>s.startGame&&s.startGame(...l))},"Начать игру")),e.gameStarted&&!e.gameEnded?(i(),n("button",{key:1,onClick:t[1]||(t[1]=(...l)=>s.endGame&&s.endGame(...l))},"Закончить игру")):a("",!0),e.gameStarted?(i(),n("div",X,[m("div",j,[(i(!0),n(p,null,k(e.images,(l,g)=>(i(),n("div",{key:g,class:"image-container"},[m("img",{src:l.src,onClick:y=>s.checkSpot(g,y)},null,8,q),e.highlightedSpots[g]?(i(),n("div",{key:0,class:"highlight",style:w(e.highlightedSpots[g].style)},null,4)):a("",!0)]))),128))]),e.gameEnded?a("",!0):(i(),n("p",z,h(e.timer)+" секунд осталось",1)),e.gameEnded?(i(),n("p",J,"Игра окончена!")):a("",!0),e.gameEnded?(i(),n("p",O,"Попаданий: "+h(e.number_correct_answers)+" из "+h(e.number_all_answers)+" возможных отличий.",1)):a("",!0),e.gameEnded?(i(),n("p",P,"Время, затраченное на игру: "+h(e.time),1)):a("",!0),e.gameEnded?(i(),n("p",Y,"Точность: "+h(e.accuracy)+"%",1)):a("",!0),e.gameEnded?(i(),n("button",{key:5,onClick:t[2]||(t[2]=(...l)=>s.startGame&&s.startGame(...l))},"Начать заново")):a("",!0)])):a("",!0),t[5]||(t[5]=m("br",null,null,-1)),d(S,{to:"/tests",class:"btn btn-secondary"},{default:x(()=>t[3]||(t[3]=[v("Назад к тестам")])),_:1})])])])],64)}const W=b(V,[["render",L]]);export{W as default};
