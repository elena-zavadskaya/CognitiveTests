import{_ as w,a as S,r as _,c as i,o as l,b as f,d as r,t as n,e as d,g as h,F as g,f as b,n as y,w as v,u as B}from"./index-BFI9Nzsh.js";/* empty css                                                       */const C={components:{Navbar:S},setup(){return{authStore:B()}},data(){return{gameStarted:!1,gameEnded:!1,currentRound:0,number_all_answers:20,number_correct_answers:0,feedback:"",leftBank:[],rightBank:[],maxValue:1,time:0,startTime:null}},computed:{formattedTime(){const s=String(Math.floor(this.time/3600)).padStart(2,"0"),e=String(Math.floor(this.time%3600/60)).padStart(2,"0"),a=String(this.time%60).padStart(2,"0");return`${s}:${e}:${a}`},accuracy(){return this.number_all_answers>0?this.number_correct_answers/this.number_all_answers*100:0}},methods:{startGame(){this.gameStarted=!0,this.gameEnded=!1,this.currentRound=1,this.number_correct_answers=0,this.feedback="",this.maxValue=1,this.time=0,this.startTime=Date.now(),this.generateRound()},generateRound(){const s=Math.floor(Math.random()*5)+3,e=Math.floor(Math.random()*5)+3;this.leftBank=this.generateCoins(s),this.rightBank=this.generateCoins(e)},generateCoins(s){const e=[];for(let a=0;a<s;a++)e.push(Math.random()<.5?1:this.maxValue);return e},handleAnswer(s){const e=this.leftBank.reduce((t,o)=>t+o,0),a=this.rightBank.reduce((t,o)=>t+o,0),m=s==="left"&&e>=a||s==="right"&&a>=e;this.feedback=m?"Правильно!":"Неправильно!",m&&this.number_correct_answers++,this.currentRound<this.number_all_answers?(this.currentRound++,this.maxValue=this.currentRound>10?2:1,setTimeout(()=>{this.feedback="",this.generateRound()},1500)):this.endGame()},endGame(){this.gameStarted=!1,this.gameEnded=!0,this.time=Math.floor((Date.now()-this.startTime)/1e3),this.saveResults()},async saveResults(){if(!this.authStore.user){alert("Пользователь не авторизован. Пожалуйста, войдите в систему.");return}const s={test:7,user:this.authStore.user.id,score_percentage:Math.round(this.accuracy),time:this.formattedTime,number_all_answers:this.number_all_answers,number_correct_answers:this.number_correct_answers};console.log("Отправляемые данные:",s);try{const e=await fetch("http://127.0.0.1:8000/api/result/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(s)}),a=await e.json();if(!e.ok)throw new Error(a.detail||a.error||`Ошибка ${e.status}`);alert("Результаты успешно сохранены!")}catch(e){console.error("Ошибка сохранения:",{error:e.message,payload:s,stack:e.stack}),alert(`Ошибка сохранения: ${e.message}`)}}}},x={class:"container mt-5 text-center"},R={id:"app"},T={key:0},M={key:1},N={class:"game-area piggy-bank-game"},V={key:2,class:"end-message"};function E(s,e,a,m,t,o){const p=_("Navbar"),k=_("router-link");return l(),i(g,null,[f(p),r("div",x,[r("h2",null,n(s.$route.params.name),1),r("div",R,[!t.gameStarted&&!t.gameEnded?(l(),i("div",T,[e[3]||(e[3]=r("h1",null,'Игра "Копилка"',-1)),e[4]||(e[4]=r("p",null,[r("strong",null,'"Копилка"'),h(" — игра на развитие скорости мышления и вычислительных навыков.")],-1)),e[5]||(e[5]=r("p",null,[r("strong",null,"Цель игры:"),h(" определить, в какой из копилок больше денег.")],-1)),r("button",{class:"start-button btn btn-primary",onClick:e[0]||(e[0]=(...u)=>o.startGame&&o.startGame(...u))},"Начать игру")])):t.gameStarted?(l(),i("div",M,[r("p",null,"Раунд: "+n(t.currentRound)+" / "+n(t.number_all_answers),1),r("p",null,"Правильные ответы: "+n(t.number_correct_answers)+" / "+n(t.number_all_answers),1),r("div",N,[r("div",{class:"piggy-bank border p-3 mx-2",onClick:e[1]||(e[1]=u=>o.handleAnswer("left"))},[(l(!0),i(g,null,b(t.leftBank,(u,c)=>(l(),i("div",{key:"left-"+c,class:"coin"},n(u),1))),128))]),r("div",{class:"piggy-bank border p-3 mx-2",onClick:e[2]||(e[2]=u=>o.handleAnswer("right"))},[(l(!0),i(g,null,b(t.rightBank,(u,c)=>(l(),i("div",{key:"right-"+c,class:"coin"},n(u),1))),128))])]),t.feedback?(l(),i("p",{key:0,class:y(["message",{correct:t.feedback==="Правильно!",incorrect:t.feedback==="Неправильно!"}])},n(t.feedback),3)):d("",!0)])):d("",!0),t.gameEnded?(l(),i("div",V,[e[6]||(e[6]=r("h3",null,"Игра завершена!",-1)),r("p",null,"Правильных ответов: "+n(t.number_correct_answers)+" из "+n(t.number_all_answers),1),r("p",null,"Точность: "+n(o.accuracy)+"%",1),r("p",null,"Время выполнения: "+n(t.time),1)])):d("",!0),f(k,{to:"/tests",class:"btn btn-secondary mt-3"},{default:v(()=>e[7]||(e[7]=[h("Назад к тестам")])),_:1})])])],64)}const z=w(C,[["render",E]]);export{z as default};
