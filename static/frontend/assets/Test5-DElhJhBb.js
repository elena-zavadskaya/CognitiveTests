import{_ as S,a as b,r as d,c as u,o as m,b as h,d as t,t as a,e as _,g as c,F as p,f as v,n as w,w as y,u as k}from"./index-BFI9Nzsh.js";const C={components:{Navbar:b},setup(){return{authStore:k()}},data(){return{gameStarted:!1,gameEnded:!1,timeLeft:50,timeElapsed:0,time:"00:00:00",activeSquare:null,number_all_answers:50,number_correct_answers:0,currentRound:0,startTime:null,gameInterval:null}},computed:{formattedTime(){const r=Math.floor(this.timeLeft/60).toString().padStart(2,"0"),e=(this.timeLeft%60).toString().padStart(2,"0");return`00:${r}:${e}`},accuracy(){return this.number_all_answers===0?0:(this.number_correct_answers/this.number_all_answers*100).toFixed(2)}},methods:{startGame(){this.gameStarted=!0,this.gameEnded=!1,this.number_correct_answers=0,this.currentRound=0,this.timeElapsed=0,this.timeLeft=50,this.time="00:00:00",this.startTime=Date.now(),this.generateRandomSquare(),this.gameInterval=setInterval(()=>{this.currentRound<this.number_all_answers?(this.currentRound++,this.timeLeft--,this.timeElapsed++,this.time=this.formatTime(this.timeElapsed),this.generateRandomSquare()):this.endGame()},1e3)},formatTime(r){const e=Math.floor(r/3600).toString().padStart(2,"0"),n=Math.floor(r%3600/60).toString().padStart(2,"0"),l=(r%60).toString().padStart(2,"0");return`${e}:${n}:${l}`},generateRandomSquare(){this.activeSquare=Math.floor(Math.random()*30)+1},handleClick(r){r===this.activeSquare&&(this.number_correct_answers++,this.generateRandomSquare())},endGame(){clearInterval(this.gameInterval),this.gameStarted=!1,this.gameEnded=!0,this.time=this.formatTime(this.timeElapsed),this.saveResults()},restartGame(){this.startGame()},async saveResults(){if(!this.authStore.user){alert("Пользователь не авторизован. Пожалуйста, войдите в систему.");return}const r=5,e=parseFloat(this.accuracy);try{const n=await fetch("http://127.0.0.1:8000/api/result/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({test:r,user:this.authStore.user.id,score_percentage:parseInt(e,10),time:this.time,number_all_answers:this.number_all_answers,number_correct_answers:this.number_correct_answers,accuracy:parseInt(e,10)})});if(n.ok)alert("Результаты успешно сохранены!");else{const l=await n.json();alert(l.detail||l.error||"Ошибка при сохранении")}}catch(n){console.error("Ошибка при отправке результатов:",n),alert("Ошибка соединения с сервером")}}}},E={class:"container mt-5 text-center"},R={id:"app"},T={key:0},q={key:1},G={class:"game-area d-flex flex-wrap justify-content-center"},I=["onClick"],x={key:2,class:"end-message"};function N(r,e,n,l,s,o){const f=d("Navbar"),g=d("router-link");return m(),u(p,null,[h(f),t("div",E,[t("h2",null,a(r.$route.params.name),1),t("div",R,[!s.gameStarted&&!s.gameEnded?(m(),u("div",T,[e[2]||(e[2]=t("h1",null,"Тест реакции",-1)),e[3]||(e[3]=t("p",null,[t("strong",null,'"Тест реакции"'),c(" — это игра для развития скорости реакции и внимания. ")],-1)),e[4]||(e[4]=t("p",null,[t("strong",null,"Цель игры:"),c(" Кликать по подсвеченным элементам как можно быстрее. ")],-1)),t("button",{class:"start-button btn btn-primary",onClick:e[0]||(e[0]=(...i)=>o.startGame&&o.startGame(...i))},"Начать игру")])):s.gameStarted?(m(),u("div",q,[t("p",null,"Оставшееся время: "+a(o.formattedTime),1),t("p",null,"Раунд: "+a(s.currentRound)+" / "+a(s.number_all_answers),1),t("p",null,"Правильные ответы: "+a(s.number_correct_answers)+" / "+a(s.number_all_answers),1),t("div",G,[(m(),u(p,null,v(30,i=>t("div",{key:i,class:w(["square",{active:i===s.activeSquare}]),onClick:L=>o.handleClick(i)},null,10,I)),64))])])):_("",!0),s.gameEnded?(m(),u("div",x,[e[5]||(e[5]=t("h3",null,"Игра завершена!",-1)),t("p",null,"Общее время: "+a(s.time),1),t("p",null,"Правильные ответы: "+a(s.number_correct_answers)+" / "+a(s.number_all_answers),1),t("p",null,"Точность: "+a(o.accuracy)+"%",1),t("button",{class:"btn btn-success",onClick:e[1]||(e[1]=(...i)=>o.restartGame&&o.restartGame(...i))},"Пройти снова")])):_("",!0),h(g,{to:"/tests",class:"btn btn-secondary mt-3"},{default:y(()=>e[6]||(e[6]=[c("Назад к тестам")])),_:1})])])],64)}const V=S(C,[["render",N]]);export{V as default};
