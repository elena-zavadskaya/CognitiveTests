import{_ as y,a as F,r as p,c as a,o as c,b as v,d as r,t as h,e as m,h as b,F as f,f as T,j as k,w as x,g as _,u as M}from"./index.js";/* empty css                                              */const S={components:{Navbar:F},setup(){return{authStore:M()}},data(){return{round:1,leftColor:"",rightColor:"",originalMovableColors:[],movableColors:[],draggedIndex:null,testStarted:!1,testCompleted:!1,testFinished:!1,correctMovableColors:0,totalCorrect:0,totalPossible:0,correctPercentages:[],startTime:0,roundTime:0,totalTime:0,time:0,accuracy:0}},methods:{generateColors(){const e=3+Math.floor(this.round/2),t=[["#FFFF00","#00FF00"],["#0000FF","#FF0000"],["#FF00FF","#00FFFF"],["#FFA500","#800080"]],l=(this.round-1)%t.length;[this.leftColor,this.rightColor]=t[l];const[n,o]=[this.leftColor,this.rightColor].map(this.hexToRgb),s={r:(o.r-n.r)/(e+1),g:(o.g-n.g)/(e+1),b:(o.b-n.b)/(e+1)};this.originalMovableColors=Array.from({length:e},(C,u)=>{const i=Math.round(n.r+s.r*(u+1)),d=Math.round(n.g+s.g*(u+1)),g=Math.round(n.b+s.b*(u+1));return`rgb(${i}, ${d}, ${g})`}),this.movableColors=[...this.originalMovableColors].sort(()=>Math.random()-.5),this.totalPossible+=e},hexToRgb(e){const t=parseInt(e.slice(1),16);return{r:t>>16&255,g:t>>8&255,b:t&255}},dragStart(e){this.draggedIndex=e},drop(e){const t=this.movableColors[this.draggedIndex];this.movableColors.splice(this.draggedIndex,1),this.movableColors.splice(e,0,t)},checkResult(){this.correctMovableColors=this.movableColors.reduce((t,l,n)=>l===this.originalMovableColors[n]?t+1:t,0),this.totalCorrect+=this.correctMovableColors;const e=this.correctMovableColors/this.movableColors.length*100;this.correctPercentages.push(e),this.testCompleted=!0},nextRound(){this.roundTime=Math.floor((Date.now()-this.startTime)/1e3),this.totalTime+=this.roundTime,this.round++,this.testCompleted=!1,this.generateColors(),this.startTime=Date.now()},finishTest(){this.roundTime=Math.floor((Date.now()-this.startTime)/1e3),this.totalTime+=this.roundTime,this.time=this.totalTime,this.testFinished=!0;const e=this.correctPercentages.reduce((t,l)=>t+l,0);this.accuracy=(e/this.correctPercentages.length).toFixed(2),this.saveResults()},startTest(){this.round=1,this.correctMovableColors=0,this.totalCorrect=0,this.totalPossible=0,this.correctPercentages=[],this.testStarted=!0,this.testCompleted=!1,this.testFinished=!1,this.totalTime=0,this.time=0,this.accuracy=0,this.startTime=Date.now(),this.generateColors()},async saveResults(){if(!this.authStore.user){alert("Пользователь не авторизован. Пожалуйста, войдите в систему.");return}const e=17,t=parseInt(this.accuracy,10);if(isNaN(t)){alert("Ошибка: некорректное значение точности.");return}console.log("Отправляемые данные:",{test:e,user:this.authStore.user.id,score_percentage:t});try{const l=await fetch("http://127.0.0.1:8000/api/result/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({test:e,user:this.authStore.user.id,score_percentage:t})});if(l.ok)alert("Результаты успешно сохранены!");else{const n=await l.json();console.error("Ошибка сервера:",n),alert(n.error||"Ошибка при сохранении результатов")}}catch(l){console.error("Ошибка при отправке результатов:",l)}}}},D={class:"container mt-5 text-center"},N={id:"app"},P={key:0},R={key:1},w={class:"color-container"},I=["onDragstart","onDrop"],A={key:2},B={key:3,class:"end-message"};function V(e,t,l,n,o,s){const C=p("Navbar"),u=p("router-link");return c(),a(f,null,[v(C),r("div",D,[r("h2",null,h(e.$route.params.name),1),r("div",N,[!o.testStarted&&!o.testFinished?(c(),a("div",P,[t[5]||(t[5]=r("h1",null,"Тест на цветовую последовательность",-1)),t[6]||(t[6]=r("p",null,"Перетащите и отпустите ящики, чтобы расположить оттенки между крайними цветами в правильной последовательности.",-1)),r("button",{class:"start-button btn btn-primary",onClick:t[0]||(t[0]=(...i)=>s.startTest&&s.startTest(...i))},"Начать тест")])):o.testStarted&&!o.testFinished?(c(),a("div",R,[r("p",null,"Раунд "+h(o.round)+" из 16",1),r("div",w,[r("div",{class:"color-box fixed",style:b({backgroundColor:o.leftColor})},null,4),(c(!0),a(f,null,T(o.movableColors,(i,d)=>(c(),a("div",{key:d,class:"color-box",style:b({backgroundColor:i}),draggable:"true",onDragstart:g=>s.dragStart(d),onDragover:t[1]||(t[1]=k(()=>{},["prevent"])),onDrop:g=>s.drop(d)},null,44,I))),128)),r("div",{class:"color-box fixed",style:b({backgroundColor:o.rightColor})},null,4)]),r("button",{class:"btn btn-primary",onClick:t[2]||(t[2]=(...i)=>s.checkResult&&s.checkResult(...i))},"Проверить")])):m("",!0),o.testCompleted&&!o.testFinished?(c(),a("div",A,[r("p",null,"Вы правильно расположили "+h(o.correctMovableColors)+" из "+h(o.movableColors.length)+" оттенков!",1),o.round<16?(c(),a("button",{key:0,class:"btn btn-primary",onClick:t[3]||(t[3]=(...i)=>s.nextRound&&s.nextRound(...i))},"Следующий раунд")):(c(),a("button",{key:1,class:"btn btn-primary",onClick:t[4]||(t[4]=(...i)=>s.finishTest&&s.finishTest(...i))},"Завершить тест"))])):m("",!0),o.testFinished?(c(),a("div",B,[r("p",null,"Тест завершён! Вы правильно расположили "+h(o.totalCorrect)+" из 256 оттенков.",1),r("p",null,"Точность выполнения: "+h(o.accuracy)+"%",1),r("p",null,"Время прохождения теста: "+h(o.time)+" секунд",1)])):m("",!0),v(u,{to:"/tests",class:"btn btn-secondary"},{default:x(()=>t[7]||(t[7]=[_("Назад к тестам")])),_:1})])])],64)}const O=y(S,[["render",V]]);export{O as default};
