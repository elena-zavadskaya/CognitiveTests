import{_ as p,a as b,r as h,c,o as l,b as m,d as e,t as r,e as g,w as T,g as _,F as N,u as v}from"./index.js";const y={components:{Navbar:b},setup(){return{authStore:v()}},data(){return{leftNumber:0,rightNumber:0,startTime:90,remainingTime:90,testFinished:!1,correctAnswers:0,totalQuestions:0,timer:null,elapsedTime:0,accuracy:0}},computed:{formattedTime(){const s=Math.floor(this.remainingTime/60).toString().padStart(2,"0"),t=(this.remainingTime%60).toString().padStart(2,"0");return`${s}:${t}`}},methods:{generateNumbers(){this.leftNumber=Math.floor(Math.random()*1e7),this.rightNumber=Math.random()<.5?this.leftNumber:this.leftNumber+Math.floor(Math.random()*10)+1},checkAnswer(s){this.leftNumber===this.rightNumber===s&&this.correctAnswers++,this.totalQuestions++,this.generateNumbers()},startTimer(){clearInterval(this.timer),this.timer=setInterval(()=>{this.remainingTime--,this.remainingTime<=0&&this.finishTest()},1e3)},finishTest(){clearInterval(this.timer),this.testFinished=!0,this.elapsedTime=this.startTime-this.remainingTime,this.accuracy=this.totalQuestions>0?this.correctAnswers/this.totalQuestions*100:0,this.saveResults()},resetTest(){this.testFinished=!1,this.correctAnswers=0,this.totalQuestions=0,this.remainingTime=this.startTime,this.elapsedTime=0,this.accuracy=0,this.startTimer(),this.generateNumbers()},async saveResults(){if(!this.authStore.user){alert("Пользователь не авторизован. Пожалуйста, войдите в систему.");return}const s=19,t=parseFloat(this.accuracy);if(isNaN(t)){alert("Ошибка: некорректное значение точности.");return}console.log("Отправляемые данные:",{test:s,user:this.authStore.user.id,score_percentage:t});try{const a=await fetch("http://127.0.0.1:8000/api/result/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({test:s,user:this.authStore.user.id,score_percentage:t})});if(a.ok)alert("Результаты успешно сохранены!");else{const u=await a.json();console.error("Ошибка сервера:",u),alert(u.error||"Ошибка при сохранении результатов")}}catch(a){console.error("Ошибка при отправке результатов:",a)}}},mounted(){this.generateNumbers(),this.startTimer()}},k={class:"container mt-5 text-center"},w={id:"app"},S={key:0,class:"result"},A={class:"controls mt-3"},C={key:1},F={class:"equation d-flex justify-content-center align-items-center gap-3"},M={class:"fs-4"},x={class:"fs-4"},I={key:0,class:"text-danger fw-bold"},Q={class:"mt-4"};function B(s,t,a,u,i,n){const d=h("Navbar"),f=h("router-link");return l(),c(N,null,[m(d),e("div",k,[e("h2",null,r(s.$route.params.name),1),e("div",w,[i.testFinished?(l(),c("div",S,[t[4]||(t[4]=e("h2",null,"Тест завершён!",-1)),e("p",null,"Вы ответили правильно на "+r(i.correctAnswers)+" из "+r(i.totalQuestions)+" вопросов",1),e("p",null,"Время выполнения теста: "+r(i.elapsedTime)+" сек",1),e("p",null,"Точность: "+r(i.accuracy.toFixed(2))+"%",1),e("div",A,[e("button",{class:"btn btn-success",onClick:t[0]||(t[0]=(...o)=>n.resetTest&&n.resetTest(...o))},"Пройти снова")])])):(l(),c("div",C,[e("div",F,[e("span",M,r(i.leftNumber),1),e("button",{class:"btn btn-primary",onClick:t[1]||(t[1]=o=>n.checkAnswer(!0))},"="),e("button",{class:"btn btn-danger",onClick:t[2]||(t[2]=o=>n.checkAnswer(!1))},"≠"),e("span",x,r(i.rightNumber),1)]),s.errorMessage?(l(),c("p",I,r(s.errorMessage),1)):g("",!0),e("button",{class:"btn btn-warning mt-3",onClick:t[3]||(t[3]=(...o)=>n.finishTest&&n.finishTest(...o))},"Готово"),e("p",null,"Оставшееся время: "+r(n.formattedTime),1)])),e("div",Q,[m(f,{to:"/tests",class:"btn btn-secondary"},{default:T(()=>t[5]||(t[5]=[_("Назад к тестам")])),_:1})])])])],64)}const j=p(y,[["render",B],["__scopeId","data-v-de758b3f"]]);export{j as default};
